<html><head>                                            
<title>MySql - ¿Cómo construir la interface para acceder a MySql?</title>       
</head>                                                 
<body bgcolor="#FFFCEA" >                        
<DIV></DIV>                                             
<table width="100%"  border="0"  cellspacing="0"  cellpadding="2"  bgcolor="#c0c0c0" >
<tr>                                                    
  <td align="left" >                                    
    <div align="left" ><font face="Arial"  color="#010101"  size="4" ><span style="FONT-SIZE: 14pt"
   >MySql - ¿Cómo construir la interface para acceder a MySql?</span></font></div>  
  </td>                                                 
  <td align="right" >                                   
    <font face="Arial"  size="2" >                      
<A href="hbole.htm"><img src="SHG_ArrowPrev.bmp" alt="Previous topic"></A>&nbsp;
<A href="QPM_2.htm"><img src="SHG_ArrowTop.bmp" alt="First topic"></A>&nbsp;
<A href="dll.lib.htm"><img src="SHG_ArrowNext.bmp" alt="Next topic"></A>
    </font>                                             
  </td>                                                 
</tr></table>                                           
<hr><br>                                                
<font face="Arial" color="#000000" size=2>Los compiladores <b>[x]Harbour</b> proveen una capa de acceso a la base de datos<b> MySql</b> mediante un set de funciones provistas como <b>Contribuci&oacute;n</b>.<br>
<br>
Esta capa de acceso se compone de una <b>librer&iacute;a estandard</b> con las funciones antes mencionadas (<b>MySql.lib</b> en [x]Harbour para Borland C y Pelles C y <b>LibMySql.a</b> en [x]Harbour para MinGW) y de una <b>Librer&iacute;a de Interface</b> (ver t&oacute;pico: <A href="interface.htm">&iquest;C&oacute;mo crear una Librer&iacute;a de Interface para acceso a DLL's?</A>) para acceso a las funciones de la DLL que provee MySql (<b>LibMySql.lib</b> en [x]Harbour para Borland y Pelles C y <b>LibMySqlDll.a</b> en [x]Harbour para MinGW)<br>
<br>
La <b>DLL</b> de <b>MySql</b> se llama <b>LibMySql.dll</b> y generalmente se encuentra en el directorio <b>\Lib\opt</b> y en el directorio <b>\Bin</b> de la instalacion de <b>MySql</b>.<br>
<br>
Algunas distribuciones de <b>minigui </b>o de <b>[x]Harbour</b> traen compiladas estas dos librer&iacute;as listas para su uso.  El problema radica en que ambas librerias deben ser creadas con elementos provistos por la version de <b>MySql</b> que querramos acceder, es decir, que esta capa de acceso a <b>MySql</b> pudo haber sido creada con una versi&oacute;n mas vieja de MySql y que nos traiga problemas al momento de usarla, es por eso que a continuacion vamos a explicar como se hace para construir esta capa de acceso desde cero basandonos en los fuentes aqui provistos: <A HREF="QPM_Samples_MySql.zip"><b><IMG SRC="QPM_IconZip.png" ALT="MySql.zip"></b></A><br>
<br>
Los fuentes fueron extra&iacute;dos de las contribuciones de <b>Harbour</b> y <b>xHarbour</b> y tienen unas peque&ntilde;as adaptaciones para poder ser compilados desde <b>QPM</b><br>
<br>
Nota: Esta librer&iacute;a fue testeada con <b>MySql 5.00.24a</b>, con otras versiones podrian presentarse errores en los procesos de generacion de la libreria.</font><br>
<br>
<li><font face="Arial" color="#000000" size=4>Generaci&oacute;n de la capa de Acceso para librerias minigui que usen Borland C y Pelles C</font></li>
<font face="Arial" color="#000000" size=4>:</font><br>
<br>
<font face="Arial" color="#000000" size=2>En este ejemplo usaremos <b>oohg</b> (Object Oriented Harbour Gui) como <b>MiniGui</b>, los compilador <b>xHarbour</b>, <b>Borland C</b> y llamaremos de la siguiente forma a las dos librer&iacute;as que construiremos:<br>
Librer&iacute;a de Funciones: <b>FunMySql.lib</b><br>
Librer&iacute;a de Interface: <b>DllMySql.lib</b><br>
<br>
Asumiremos que la instalaci&oacute;n de <b>MySql </b>esta en el directorio <b>c:\MySql</b><br>
<br>
Para construir la libreria <b>FunMySql.lib</b> hay que crear un proyecto de tipo <b>LIB</b>, seleccionar <b>oohg</b> como <b>MiniGui</b> y <b>xHarbour</b> como compilador.  <br>
Renombrar la libreria como <b>FunMySql </b>(mediante la opcion <b>Rename</b> de <b>Project Options</b>)<br>
Tambien es interesante utilizar la opcion de agregar un sufijo a la libreria resultante.  <A href="projectsettings.htm#sufijo">Haga click aqui para aprender m&aacute;s sobre sufijos</A><br>
Luego hay que incluir los siguientes fuentes:<br>
<b>MySql.c<br>
TSqlBrw.prg<br>
TMySql.prg</b><br>
desde el subdirectorio <b>\xHarbourSource </b><br>
En la pesta&ntilde;a de Headers (H & CH) es necesario incluir los siguientes encabezados:<br>
<b>MySql.ch</b> (desde <b>\xHarbourSource</b>)<br>
<b>MySql.h</b> (desde <b>c:\MySql\include</b>, </font><font face="Arial" color="#FF0000" size=2>esta es una de las dependencias de la version de MySql ya que se distribuye directamente con la base de datos</font><font face="Arial" color="#000000" size=2>) <br>
<br>
<b><IMG SRC="QPM_MySql_Includes.png" BORDER=2></b><br>
<br>
En este momento estamos en condiciones de hacer build de nuestro proyecto:<br>
<br>
<b><IMG SRC="QPM_MySql_CompileLib.png" BORDER=2></b><br>
<br>
El resultado de esta generacion lo podemos observar en la pesta&ntilde;a de Output Error/Module:<br>
<br>
<b><IMG SRC="QPM_MySql_Output.png" BORDER=2> </b><br>
<br>
Una vez que hayamos contruido la <b>libreria de funciones propias</b> de <b>xHarbour</b> para la capa de acceso a <b>MySql</b> s&oacute;lo nos falta construir la <b>Librer&iacute;a de Interface</b> para poder utilizar las funciones de la <b>DLL</b> que nos provee <b>MySql</b>.<br>
<br>
Para ello crearemos un proyecto de tipo <b>Interface Library</b> y seleccionaremos la <b>minigui con la cual se usar&aacute; la librer&iacute;a</b>, y luego elegimos el <b>compilador C (Borland o Pelles C)</b>.<br>
Esta librer&iacute;a de Interface la llamaremos <b>DllMySql.lib</b>, para ello usaremos la opcion de <b>Rename</b> de <b>QPM</b>.<br>
<br>
<b><IMG SRC="QPM_MySql_InterfaceSettings.png" BORDER=2></b><br>
<br>
Luego se elige la <b>DLL</b> que nos servir&aacute; de entrada en el proceso de construccion de la librer&iacute;a de interface.  La <b>DLL</b> en cuesti&oacute;n es la distribuida con la instalaci&oacute;n de MySql, se llama <b>LibMySql.dll</b>, se encuentra en el subdirectorio <b>\lib\opt</b> de la instalaci&oacute;n de <b>MySql</b> (en nuestro ejemplo <b>c:\MySql\lib\opt</b>) </font><font face="Arial" color="#FF0000" size=2>y es la segunda de las restricciones por la cual podr&iacute;a no funcionarnos la capa de acceso a MySql que viene contruida con nuestro compilador <b>[x]Harbour</b>.</font><br>
<font face="Arial" color="#000000" size=2>Note que QPM listar&aacute; automaticamente el contenido de la DLL.  </font><br>
<br>
<font face="Arial" color="#FF0000" size=2><b>En el caso de Pelles C tildamos la opci&oacute;n Add '_' alias </b></font><br>
<br>
<font face="Arial" color="#000000" size=2><b><IMG SRC="QPM_MySql_InterfaceListInput.png" BORDER=2></b><br>
<br>
Luego se hace <b>Build</b> del proyecto y se genera la <b>Librer&iacute;a de Interface</b>.  <br>
<br>
<b>Nota</b>: El archivo con extension <b>def</b> que se elimina al final del proceso es un archivo temporal.<br>
<br>
<b><IMG SRC="QPM_MySql_InterfaceBuild.png" BORDER=2></b><br>
<br>
El resultado del proceso, es decir, el contenido de la Librer&iacute;a de Interface que acabamos de crear se puede ver en <b>Output Error/Module</b> mediante el bot&oacute;n <b>List Output File (or ReList)<br>
<br>
<IMG SRC="QPM_Interface_ListOutput.png" BORDER=2></b></font><br>
<br>
<br>
<li><font face="Arial" color="#000000" size=4>Generaci&oacute;n de la capa de Acceso para librerias minigui que usen MinGW</font></li>
<font face="Arial" color="#000000" size=4>:</font><br>
<br>
<font face="Arial" color="#000000" size=2>En este ejemplo usaremos <b>Oficial Minigui 3.x</b>, el compilador <b>Harbour</b> y llamaremos de la siguiente forma a las dos librer&iacute;as que construiremos:<br>
Librer&iacute;a de Funciones: <b>LibFunMySql.a</b><br>
Librer&iacute;a de Interface: <b>LibDllMySql.a</b></font><br>
<font face="Arial" color="#FF0000" size=2>Nota: Recordar que MinGW agrega automaticamente el prefijo <b>Lib</b> a las librer&iacute;as</font><br>
<br>
<font face="Arial" color="#000000" size=2>Asumiremos que la instalaci&oacute;n de <b>MySql </b>esta en el directorio <b>c:\MySql</b><br>
<br>
Para construir la libreria <b>LibFunMySql.a</b> hay que crear un proyecto de tipo <b>LIB</b>, seleccionar <b>Oficial MiniGui 3.x</b> y <b>Harbour</b> como compilador.  <br>
Renombrar la libreria como <b>FunMySql </b>(mediante la opcion <b>Rename</b> de <b>Project Options</b>) (<b>QPM</b> agregar&aacute; el prefijo <b>Lib</b> automaticamente)<br>
Tambien es interesante utilizar la opcion de agregar un sufijo a la libreria resultante.  <A href="projectsettings.htm#sufijo">Haga click aqui para aprender m&aacute;s sobre sufijos</A><br>
Luego hay que incluir los siguientes fuentes:<br>
<b>MySql.c<br>
TSqlBrw.prg<br>
TMySql.prg</b><br>
desde el subdirectorio <b>\HarbourSource </b><br>
En la pesta&ntilde;a de Headers (H & CH) es necesario incluir los siguientes encabezados:<br>
<b>MySql.ch</b> (desde <b>\HarbourSource</b>)<br>
<b>MySql.h</b> (desde <b>c:\MySql\include</b>, </font><font face="Arial" color="#FF0000" size=2>esta es una de las dependencias de la version de MySql ya que se distribuye directamente con la base de datos</font><font face="Arial" color="#000000" size=2>) <br>
<br>
<b><IMG SRC="QPM_MySql_MinGWIncludes.png" BORDER=2></b><br>
<br>
En este momento estamos en condiciones de hacer build de nuestro proyecto:<br>
<br>
<b><IMG SRC="QPM_MySql_MinGWCompileLib.png" BORDER=2></b><br>
<br>
El resultado de esta generacion lo podemos observar en la pesta&ntilde;a de Output Error/Module:<br>
<br>
<b><IMG SRC="QPM_MySql_MinGWOutput.png" BORDER=2> </b><br>
<br>
Una vez que hayamos contruido la <b>libreria de funciones propias</b> de <b>Harbour</b> para la capa de acceso a <b>MySql</b> s&oacute;lo nos falta construir la <b>Librer&iacute;a de Interface</b> para poder utilizar las funciones de la <b>DLL</b> que nos provee <b>MySql</b>.<br>
<br>
Para ello crearemos un proyecto de tipo <b>Interface Library</b> y seleccionaremos la <b>minigui con la cual se usar&aacute; la librer&iacute;a (OOHG 3.x</b> u <b>Oficial MiniGui 3.x)</b>, y luego elegimos el <b>compilador C (MinGW)</b>.<br>
Esta librer&iacute;a de Interface la llamaremos <b>LibDllMySql.a</b>, para ello usaremos la opcion de <b>Rename</b> de <b>QPM</b>. </font><br>
<font face="Arial" color="#FF0000" size=2>Nota: Recordar que bastar&aacute; con codificar <b>DllMySql </b>ya que <b>QPM</b> agregar&aacute; el prefijo <b>Lib</b> en forma autom&aacute;tica</font><br>
<br>
<font face="Arial" color="#000000" size=2><b><IMG SRC="QPM_MySql_MinGWInterfaceSettings.png" BORDER=2></b><br>
<br>
Luego se elige la <b>DLL</b> que nos servir&aacute; de entrada en el proceso de construccion de la librer&iacute;a de interface.  La <b>DLL</b> en cuesti&oacute;n es la distribuida con la instalaci&oacute;n de MySql, se llama <b>LibMySql.dll</b>, se encuentra en el subdirectorio <b>\lib\opt</b> de la instalaci&oacute;n de <b>MySql</b> (en nuestro ejemplo <b>c:\MySql\lib\opt</b>) </font><font face="Arial" color="#FF0000" size=2>y es la segunda de las restricciones por la cual podr&iacute;a no funcionarnos la capa de acceso a MySql que viene contruida con nuestro compilador <b>[x]Harbour</b>.</font><br>
<font face="Arial" color="#000000" size=2>Note que QPM listar&aacute; automaticamente el contenido de la DLL.  <br>
<br>
<b><IMG SRC="QPM_MySql_MinGWInterfaceListInput.png" BORDER=2></b><br>
<br>
Para este caso en particular (me refiero a <b>MySql</b>) usaremos el m&eacute;todo alternativo de construcci&oacute;n de la libreria de interface que consiste en tomar como guia para la obtencion de la lista de funciones de la <b>DLL</b> (<b>reimportar</b>) a otra librer&iacute;a de interface contruida para <b>Borland C</b> y provista por <b>MySql</b>.<br>
Esto se hace tildando la opcion "<b>Reimport from .Lib library"</b> y eligiendo como libreria la que se encuentra en el mismo directorio de la <b>DLL</b> llamada <b>LibMySql.lib</b><br>
<br>
<b><IMG SRC="QPM_MySql_MinGWInterfaceReImport.png" BORDER=2></b><br>
<br>
Luego se hace <b>Build</b> del proyecto y se genera la <b>Librer&iacute;a de Interface</b>.  <br>
<br>
<b>Nota</b>: El archivo con extension <b>def</b> que se elimina al final del proceso es un archivo temporal.<br>
<br>
<b><IMG SRC="QPM_MySql_MinGWInterfaceBuild01.png" BORDER=2></b><br>
<br>
<b><IMG SRC="QPM_MySql_MinGWInterfaceBuild02.png" BORDER=2></b><br>
<br>
El resultado del proceso, es decir, el contenido de la Librer&iacute;a de Interface que acabamos de crear se puede ver en <b>Output Error/Module</b> mediante el bot&oacute;n <b>List Output File (or ReList)<br>
<br>
<IMG SRC="QPM_MySql_MinGWInterfaceListOutput.png" BORDER=2></b></font><br>
<br>
<br>
<li><font face="Arial" color="#000000" size=4>&iquest;C&oacute;mo compilar el sample de MySql?</font></li>
<font face="Arial" color="#000000" size=4>:</font><br>
<br>
<font face="Arial" color="#000000" size=2>El sample que se encuentra en los fuentes que se adjuntan en este help son v&aacute;lidos tanto para las minigui que usan <b>Borland C, Pelles C,</b> como para las que usan <b>MinGW</b> aunque en este tutorial usaremos <b>oohg</b>,<b> xHarbour</b> y<b> Borland C</b> (solo se hace mencion a MinGW para mostrar la diferencia que hay en los nombres de librerias a Incluir/Excluir, el resto es similar).<br>
<br>
Para compilar dicho demo es necesario crear un proyecto de tipo <b>EXE</b> y elegir la minigui <b>oohg</b> junto con <b>xHarbour</b>.<br>
<br>
Luego agregamos el fuente llamado Demo_1.prg<br>
<br>
En la pesta&ntilde;a de Librerias hay que incluir las dos librerias que acabamos de construir:<br>
<br>
Es conveniente <b>EXCLUIR</b> las originales librerias que venian con el compilador <b>xHarbour</b> agregandolas en la lista de exclude:</font><br>
<br>
<font face="Arial" color="#5997CA" size=2><b>MySql.lib</b> y <b>LibMySql.lib</b> en [x]Harbour para Borland C y <b>LibMySql.a</b> y <b>LibMySqlDll.a</b> en [x]Harbour para MinGW</font><br>
<br>
<font face="Arial" color="#000000" size=2>Para Borland C y Pelles C:<br>
<br>
<b><IMG SRC="QPM_MySql_DemoInclude.png" BORDER=2></b><br>
<br>
Para MinGW:<br>
<br>
<b><IMG SRC="QPM_MySql_DemoMinGWInclude.png" BORDER=2></b><br>
<br>
Luego hacemos build de nuestro proyecto y si todo sale bien y MySql esta bien instalado y funcionando correctamente, ya estamos en condiciones de usar el demo<br>
<br>
En algunos casos, cuando se compila con Harbour, la linkedicion del Sample va a requerir de dos funciones de OLE:<br>
TOLEAUTO() y OLE2TXTERROR()<br>
Para solucionar este tema ver el topico </font><font face="Arial" size=2><A href="hbole.htm">&iquest;C&oacute;mo construir la librer&iacute;a de enlace din&aacute;mico?</A></font><br>
<font face="Arial" color="#000000" size=2>En las nuevas versiones de xHarbour no sucede porque la libreria OLE paso a formar parte de la distribucion oficial.<br>
<br>
<b><IMG SRC="QPM_MySql_DemoBuild.png" BORDER=2></b><br>
<br>
Para el caso de <b>Harbour</b> y para mas seguridad de que se estan usando nuestras librerias, tambien es aconsejable eliminar o renombrar las librerias de mySql que trae la minigui (usualmente en el directorio \LIB de Harbour)</font><br>
<br>
<font face="Arial" color="#FF0000" size=2>Nota: Tambien he notado que en algunos casos la capa de acceso a <b>MySql</b> tiene coliciones con funciones que se encuentran dentro de la librer&iacute;a <b>hbodbc.lib</b> (<b>Libhbodbc.a</b> para <b>MinGW</b>), y esto provoca que nuestra aplicacion cancele abruptamente en el momento de conectarse con <b>MySql</b>, por lo tanto, si se encuentra concatenada en la linkedicion es preferible excluirla.<br>
Si no fuera posible excluirla, se aconseja concatenarla despues de las dos librerias de MySql que hemos creado, ya sea mediante el atributo *First* para nuestras librerias como excluyendo la libreria hbodbc y luego incluyendola detras de nuestras dos librerias.</font><br>
 
<p><hr><p>                                                            
<table width=100%><tr><td align="center"><font face="Arial" color="#000000" size=2><b><IMG SRC="QPM.bmp"></b></font><b><font face="Arial" size=2>   QPM</b> (QAC Based Project Manager) </font><b><font face="Arial" color="#0000FF" size=2>Version 05.02</b></font><br>
<br>
<font face="Arial" color="#E20362" size=2><b><i>Compilaci&oacute;n Incremental con las tres versiones de librer&iacute;as mas populares de la familia MiniGui: Oficial MiniGui, Extended MiniGui y Object Oriented Harbour Gui (OOHG)</i></b></font><br>
<br>
<font face="Arial" size=2><b><A href="mailto:qpm-users@lists.sourceforge.net" >Lista de usuarios: qpm-users@lists.sourceforge.net</A></b></font><br>
<br>
<font face="Arial" color="#0000FF" size=2><b><A href="http://qpm.sourceforge.net" target=blank>Sitio del proyecto: qpm.sourceforge.net</A></b></font></td></tr></table><br>
<br>
<br>
 

<table width="100%"  border="0"  cellspacing="0"  cellpadding="2"  bgcolor="#c0c0c0" > 
  <TBODY>                                                             
  <tr>                                                                
    <td align="left" ><font face="Arial"  color="#010101"  size="4" ><span style="FONT-SIZE: 14pt"
     >                                                                
      <P>                                                             
      <P align=left><FONT size=2><A href="http://qpm.sourceforge.net" target=blank>Powered by QPM</A>&nbsp;&nbsp;</FONT>               
      </P></span></font></td>                                         
    <td align="right" >                                               
      <font face="Arial"  size="2" >                                  
<A href="hbole.htm"><img src="SHG_ArrowPrev.bmp" alt="Previous topic"></A>&nbsp;
<A href="QPM_2.htm"><img src="SHG_ArrowTop.bmp" alt="First topic"></A>&nbsp;
<A href="dll.lib.htm"><img src="SHG_ArrowNext.bmp" alt="Next topic"></A>
      </font>                                                         
    </td></tr></TBODY></table><hr></body></html>                          